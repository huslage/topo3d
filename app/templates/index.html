<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Topo3D - Topographical 3D Model Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/app.css">
</head>
<body data-mode="setup">
    <div class="app-shell">
        <header class="topbar">
            <div class="brand-block">
                <h1>Topo3D</h1>
                <p>Generate printable terrain, then refine quickly.</p>
            </div>
            <nav class="mode-tabs" aria-label="Workspace mode">
                <button class="mode-tab active" data-mode="setup">Setup</button>
                <button class="mode-tab" data-mode="edit">Edit</button>
                <button class="mode-tab" data-mode="export">Export</button>
            </nav>
            <div class="top-actions">
                <button id="quick-preview-btn" class="btn btn-primary">Generate Preview</button>
                <button id="quick-export-btn" class="btn btn-accent">Export 3MF</button>
            </div>
        </header>

        <main class="workspace-grid">
            <aside class="panel panel-left">
                <section id="setup-mode-panel" class="mode-panel active" data-panel="setup">
                    <div class="panel-section">
                        <h2>1. Upload</h2>
                        <div class="file-upload">
                            <input type="file" id="gpx-file" accept=".gpx">
                            <label for="gpx-file" class="btn btn-primary btn-block">Choose GPX File</label>
                            <div class="muted" id="file-name">No file selected</div>
                        </div>
                    </div>

                    <div class="panel-section">
                        <h2>2. Location</h2>
                        <input type="text" id="address-input" placeholder="Paste Google Maps URL or enter address">
                        <button id="geocode-btn" class="btn btn-secondary">Find Location</button>
                        <div class="check-row">
                            <input type="checkbox" id="show-only-address-building" disabled>
                            <label for="show-only-address-building">Show only address building</label>
                        </div>
                        <p class="muted" id="address-status"></p>
                    </div>

                    <div class="panel-section">
                        <h2>3. Model</h2>
                        <div class="slider-group">
                            <label>
                                Model Width
                                <span id="model-width-value">200</span>mm
                            </label>
                            <input type="range" id="model-width" min="50" max="500" step="10" value="200">
                        </div>
                        <div class="check-row">
                            <input type="checkbox" id="include-base" checked>
                            <label for="include-base">Include Base</label>
                        </div>

                        <details id="advanced-settings">
                            <summary>Advanced Settings</summary>
                            <div class="advanced-content">
                                <div class="slider-group">
                                    <label>
                                        Vertical Scale
                                        <span id="vertical-scale-value">1.0</span>x
                                    </label>
                                    <input type="range" id="vertical-scale" min="0.5" max="3" step="0.1" value="1.0">
                                </div>
                                <div class="slider-group">
                                    <label>
                                        Base Height
                                        <span id="base-height-value">10</span>mm
                                    </label>
                                    <input type="range" id="base-height" min="0" max="50" step="1" value="10">
                                </div>
                                <div class="slider-group">
                                    <label>
                                        Boundary Padding
                                        <span id="boundary-padding-value">100</span>m
                                    </label>
                                    <input type="range" id="boundary-padding" min="0" max="200" step="10" value="100">
                                </div>
                                <label class="field-label" for="model-shape">Model Shape</label>
                                <select id="model-shape">
                                    <option value="square">Square</option>
                                    <option value="circle">Circle</option>
                                    <option value="rectangle">Rectangle (Auto Aspect)</option>
                                    <option value="hexagon">Hexagon</option>
                                </select>
                            </div>
                        </details>
                    </div>

                    <div class="panel-section">
                        <h2>4. Generate</h2>
                        <button id="generate-preview-btn" class="btn btn-primary btn-block">Generate 3D Model</button>
                        <button id="generate-final-btn" class="btn btn-secondary btn-block">Generate Final Quality</button>
                    </div>
                </section>

                <section id="export-mode-panel" class="mode-panel" data-panel="export">
                    <div class="panel-section">
                        <h2>Export</h2>
                        <p class="muted">Export uses your current scene edits. Hidden objects are still exported unless deleted.</p>
                        <button id="export-3mf-btn" class="btn btn-accent btn-block">Export to 3MF</button>
                    </div>
                </section>
            </aside>

            <section class="viewer-container">
                <div id="canvas-container"></div>
                <div id="status-message" class="status-floating"></div>
                <div id="selection-box"></div>
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Processing...</p>
                </div>
                <div id="render-debug" class="render-debug">Render diagnostics pending...</div>
                <div class="controls-overlay">
                    <h4>Controls</h4>
                    <p><strong>Rotate:</strong> Left drag</p>
                    <p><strong>Pan:</strong> Right drag</p>
                    <p><strong>Zoom:</strong> Scroll</p>
                    <p><strong>Select:</strong> Click object</p>
                    <p><strong>Box select:</strong> Enable in Edit panel</p>
                </div>
            </section>

            <aside class="panel panel-right">
                <section id="edit-mode-panel" class="mode-panel" data-panel="edit">
                    <div class="panel-section">
                        <h2>Editing</h2>
                        <div class="toolbar-row">
                            <button id="toggle-box-select-btn" class="btn btn-outline">Box Select: Off</button>
                            <button id="select-visible-btn" class="btn btn-outline">Select Visible</button>
                            <button id="clear-selection-btn" class="btn btn-outline">Clear</button>
                        </div>
                        <div class="toolbar-row">
                            <button id="delete-selected-btn" class="btn btn-danger">Delete Selected</button>
                            <button id="hide-selected-btn" class="btn btn-outline">Hide Selected</button>
                            <button id="show-all-btn" class="btn btn-outline">Show All</button>
                        </div>
                        <div class="stats-row">
                            <span id="results-count">0 results</span>
                            <span id="selection-count">0 selected</span>
                        </div>
                    </div>

                    <div class="panel-section">
                        <h2>Objects</h2>
                        <input type="text" id="object-search" placeholder="Search objects">
                        <div class="filter-chips" id="filter-chips">
                            <button class="chip active" data-filter="terrain">Terrain</button>
                            <button class="chip active" data-filter="building">Buildings</button>
                            <button class="chip active" data-filter="road">Roads</button>
                            <button class="chip active" data-filter="water">Water</button>
                            <button class="chip active" data-filter="gpx_track">GPX</button>
                            <button class="chip active" data-filter="marker">Markers</button>
                            <button class="chip active" data-filter="label">Labels</button>
                        </div>
                        <div class="object-list" id="object-list"></div>
                    </div>

                    <div class="panel-section">
                        <h2>Add Label</h2>
                        <div class="inline-form">
                            <input type="text" id="label-text" placeholder="Label text">
                            <button id="add-label-btn" class="btn btn-outline">Add</button>
                        </div>
                    </div>

                    <div class="panel-section">
                        <h2>History</h2>
                        <div class="toolbar-row">
                            <button id="undo-btn" class="btn btn-outline">Undo</button>
                            <button id="redo-btn" class="btn btn-outline">Redo</button>
                        </div>
                        <p class="muted">Shortcuts: Delete, Ctrl/Cmd+Z, Ctrl/Cmd+Shift+Z, A (select visible)</p>
                    </div>
                </section>
            </aside>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script type="module" src="/static/js/app.js"></script>
</body>
</html>
